<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT"
      crossorigin="anonymous"
    />
    <title>Controle Estoque</title>
    <style>
      input {
        width: 80px;
      }
    </style>
  </head>
  <body>
    <div class="table-responsive-sm">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Produto</th>
            <th>UPC</th>
            <th>Qt atual</th>
            <th>Qt entrada</th>
            <th>Qt sa√≠da</th>
          </tr>
        </thead>
        <tbody>
          <tr id="line-1">
            <td>Doritos 140g</td>
            <td>15</td>
            <td id="total-1" class="totalIpt">0</td>
            <td>
              <input type="number" id="qtEntrada-1" class="iptEntrada" min="0" />
            </td>
            <td>
              <input type="number" id="qtSaida-1" class="iptSaida" min="0" />
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <script>
      let produtos = getStorage();

      let inputEntrada = document.getElementById('qtEntrada-1');
      let inputSaida = document.getElementById('qtSaida-1');
      let inputTotal = document.getElementById('total-1');

      inputTotal.innerHTML = produtos[0].qt;

      inputEntrada.addEventListener('blur', () => {
        calc();
      });
      inputSaida.addEventListener('blur', () => {
        calc();
      });

      function calc() {
        let atual = Number(inputTotal.innerHTML);
        let entrada = Number(inputEntrada.value);
        let saida = Number(inputSaida.value);

        let total = atual + entrada - saida;

        inputTotal.innerHTML = total;

        inputEntrada.value = '';
        inputSaida.value = '';

        let produto = {
          id: 1,
          qt: parseInt(document.getElementById(`total-1`).innerText),
        };

        let newProdutosArray = [];

        produtos.forEach((produto) => {
          if (produto.id !== 1) {
            produto.id = newProdutosArray.length + 1;
            newProdutosArray.push(produto);
          }
        });

        produtos = newProdutosArray;
        produtos.push(produto);

        saveStorage();
      }

      function saveStorage() {
        localStorage.setItem('produtos', JSON.stringify(produtos));
      }

      function getStorage() {
        return JSON.parse(localStorage.getItem('produtos') || '[]');
      }
    </script>
  </body>
</html>
